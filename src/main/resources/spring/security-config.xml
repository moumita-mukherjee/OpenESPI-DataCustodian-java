<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:util="http://www.springframework.org/schema/util" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:sec="http://www.springframework.org/schema/security"
	xmlns:security="http://www.springframework.org/schema/security"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
       		 http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
			 http://www.springframework.org/schema/security
			 http://www.springframework.org/schema/security/spring-security-3.2.xsd
			  http://www.springframework.org/schema/util  http://www.springframework.org/schema/util/spring-util-3.1.xsd">





	<!-- <http auto-config="true" use-expressions="true"
		authentication-manager-ref="authenticationManager" access-denied-page="/login?authorization_error=true"
		disable-url-rewriting="true" xmlns="http://www.springframework.org/schema/security">	
		
    	<custom-filter ref="autoLoginFilter" position="PRE_AUTH_FILTER" /> 
    
		<intercept-url pattern="/oauth/**" access="hasRole('ROLE_USER')" />
		<intercept-url pattern="/RetailCustomer/**" access="hasRole('ROLE_USER')" />
		<intercept-url pattern="/**" />
		<form-login authentication-failure-url="/login?authentication_error=true"
			default-target-url="/default" login-page="/login" />
		<logout logout-success-url="/" logout-url="/logout.do"
			invalidate-session="true" />
		<anonymous />

	</http>



	<bean id="passwordEncoder" class="org.energyos.espi.common.utils.SHA1PasswordEncoder" />
	<authentication-manager alias="authenticationManager"
		xmlns="http://www.springframework.org/schema/security">
		<authentication-provider user-service-ref="defaultLoginService">
			<sec:password-encoder ref="passwordEncoder">
				<sec:salt-source user-property="salt" />
			</sec:password-encoder>
		</authentication-provider>
	</authentication-manager>
	


<bean id="autoLoginFilter"
		class="org.energyos.espi.datacustodian.web.filter.CustomPreAuthenticaionProcessingFilter">
		<property name="authenticationManager" ref="authenticationManager"/>
	</bean>
	
</beans> -->

 <bean id="simpleOAuthAuthenticationProvider" class="org.energyos.espi.datacustodian.web.filter.SimpleOAuthAuthenticationProvider">
		<property name="configuration">
			<bean
				class="org.springframework.security.authentication.jaas.memory.InMemoryConfiguration">
				<constructor-arg>
					<map>
						
						<entry key="SPRINGSECURITY">
							<array>
								<bean class="javax.security.auth.login.AppConfigurationEntry">
									<constructor-arg value="sample.SampleLoginModule" />
									<constructor-arg>
										<util:constant
											static-field="javax.security.auth.login.AppConfigurationEntry$LoginModuleControlFlag.REQUIRED" />
									</constructor-arg>
									<constructor-arg>
										<map></map>
									</constructor-arg>
								</bean>
							</array>
						</entry>
					</map>
				</constructor-arg>
			</bean>
		</property>
		<property name="authorityGranters">
			<list>
				<bean class="org.energyos.espi.datacustodian.web.filter.CustomAuthorityGranter" />
			</list>
		</property>
	</bean> 
	

 
	<http auto-config="true" use-expressions="false"
	    authentication-manager-ref="authenticationManager"
	    access-decision-manager-ref="accessDecision"
		 access-denied-page="/login?authorization_error=true"
		disable-url-rewriting="true" xmlns="http://www.springframework.org/schema/security">			
		<intercept-url pattern="/oauth/**" access="ROLE_USER" />
		<intercept-url pattern="/RetailCustomer/**" access="ROLE_USER" />
		<intercept-url pattern="/**" />
		<form-login authentication-failure-url="/login?authentication_error=true"
			default-target-url="/default" login-page="/login" />
		<logout logout-success-url="/api/v1/public/logout" invalidate-session="true"
        delete-cookies="true" logout-url="/logout.do" />
		<anonymous />
		<custom-filter ref="autoLoginFilter" position="PRE_AUTH_FILTER" />  
		<!--<custom-filter ref="autoLoginFilter" position="FORM_LOGIN_FILTER" />-->

	 </http>
	
	<authentication-manager
		alias="authenticationManager" xmlns="http://www.springframework.org/schema/security" erase-credentials="false">
		<authentication-provider ref="simpleOAuthAuthenticationProvider">			
		</authentication-provider>
	</authentication-manager>

	
	<bean id="autoLoginFilter"
		class="org.energyos.espi.datacustodian.web.filter.CustomPreAuthenticaionProcessingFilter">
		<property name="authenticationManager" ref="authenticationManager"/>
	</bean>

	<bean id="accessDecision" class="org.energyos.espi.datacustodian.web.filter.SimpleToeknBased"
		xmlns="http://www.springframework.org/schema/beans">
		<property name="decisionVoters">
			<set>
				<bean class="org.springframework.security.access.vote.RoleVoter"></bean>
			</set>
		</property>
	</bean> 
</beans>

